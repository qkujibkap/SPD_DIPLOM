VKinder — Бот для поиска знакомств во ВКонтакте

VKinder — это чат-бот для платформы ВКонтакте, который подбирает людей для знакомств
на основе данных самого пользователя (пол, возраст, город), показывает карточки
кандидатов с фотографиями и позволяет сохранять понравившихся в избранное.

------------------------------------------------------------
Возможности бота
------------------------------------------------------------

- Получение информации о пользователе VK (возраст, пол, город)
- Поиск подходящих кандидатов через VK API
- Формирование карточки:
  * имя и фамилия пользователя
  * ссылка на профиль
  * три лучших фото по лайкам
- Работа с избранными:
  * добавление в favorites.json
  * просмотр всех добавленных
- Обработка команд:
  * Начать
  * Следующий
  * В избранное
  * Показать избранных
  * Стоп

------------------------------------------------------------
Структура проекта
------------------------------------------------------------

project/

      bot.py               — Основная логика чат-бота
      vk_client.py         — Работа с VK API (поиск, фото)
      favorites.py         — Работа с favorites.json
      config.py            — Конфигурация и переменные окружения
      favorites.json       — Хранилище избранных пользователей
      README.md            — Документация
      DATA_SCHEMA.md       — Схема данных favorites.json
      requirements.txt     — Зависимости проекта
      .gitignore           — Игнорируемые файлы

------------------------------------------------------------
bot.py — Основная логика бота
------------------------------------------------------------

Файл bot.py — центральная часть проекта. Он отвечает за обработку команд,
подбор людей, отправку карточек и управление избранным.

1. Обработка команд пользователя

Бот распознает команды:
- начать
- следующий
- в избранное
- показать избранных
- стоп

2. Получение данных о текущем пользователе VK

Бот автоматически получает:
- пол
- дату рождения (вычисляет возраст)
- город

Эти данные используются для поиска.

3. Формирование параметров поиска

Бот определяет:
- противоположный пол
- диапазон возраста: ±2 года
- город пользователя

Фильтры кешируются и используются повторно.

4. Поиск подходящих людей

Через VKClient.search_users():
- выбирается случайный offset
- выбирается случайный человек из результатов
- один и тот же человек не показывается дважды
  (множество shown_users)

5. Формирование карточки пользователя

Карточка содержит:
- имя и фамилию
- ссылку на профиль
- 3 лучших фото по лайкам (VKClient.get_top_photos)
- интерактивную клавиатуру

6. Работа с избранными

Команда «В избранное»:
- берет текущего кандидата
- получает его top-3 фото
- формирует структурированную запись:
  {
    id,
    first_name,
    last_name,
    profile_url,
    photos,
    _added_at
  }
- сохраняет через favorites.py

Команда «Показать избранных» выводит полный список избранных.

7. Обработка ошибок

Бот:
- защищён от падений
- перехватывает ошибки API
- уведомляет пользователя
- корректно завершает работу по команде Стоп

------------------------------------------------------------
Схема файла favorites.json
------------------------------------------------------------

Каждая запись выглядит так:

    {
      "id": <int>,
      "first_name": "<str>",
      "last_name": "<str>",
      "profile_url": "<str>",
      "photos": [
        "photo123_456",
        "photo123_789",
        "photo123_101112"
      ],
      "_added_at": "<ISO-8601>"
    }

Подробнее см. DATA_SCHEMA.md.

------------------------------------------------------------
config.py
------------------------------------------------------------

Файл использует переменные окружения:

    TOKEN_GROUP = os.getenv("TOKEN_GROUP")
    TOKEN_USER  = os.getenv("TOKEN_USER")
    GROUP_ID    = int(os.getenv("GROUP_ID"))

Это безопасно и соответствует требованиям.

------------------------------------------------------------
vk_client.py
------------------------------------------------------------

Содержит:
    
    - search_users() — поиск по полу, возрасту, городу
    - get_top_photos() — получение топ-3 фото с fallback profile → wall

------------------------------------------------------------
favorites.py
------------------------------------------------------------

Отвечает за:
    
    - загрузку/сохранение favorites.json
    - добавление записи
    - проверку дубликатов
    - авто-создание файла при отсутствии

------------------------------------------------------------
Установка и запуск
------------------------------------------------------------

1. Установить зависимости:

        pip install -r requirements.txt

2. Установить переменные окружения:

   Mac/Linux:

         export TOKEN_GROUP="..."
         export TOKEN_USER="..."
         export GROUP_ID=123456

   Windows CMD:
        
         set TOKEN_GROUP=...
         set TOKEN_USER=...
         set GROUP_ID=123456

3. Запустить бота:
      
          python bot.py